 <!--source for sparql data to json https://beta.vizhub.com/Razpudding/2b231e4f093b411bbb259115019e02ea?edit=files&file=index.js -->

<!DOCTYPE html>
  <meta charset="utf-8">
  <head>
      <title>Simple Circle Pack</title>
      <script src="https://d3js.org/d3.v5.min.js"></script>
      <script src="index.js"></script>
      <link href="styles.css" rel="stylesheet">
  </head>
  <body>
    <svg>
        <g></g>
    </svg>
  </body>
</html>

<script>

  // Prepare our physical space for d3
  prepare_HTML_space()
  function prepare_HTML_space() {
    let Width = 600
    let Height = 400
    let g = d3.select('svg').attr('width', Width).attr('height', Height).select('g')
  }

  // import data from api and return values --> values in array --> merge arrays
  // import data from api and return values
  sparQL_queries()
  function sparQL_queries() {
       const endpoint = 'https://api.data.netwerkdigitaalerfgoed.nl/datasets/ivo/NMVW/services/NMVW-19/sparql';
       const query_IDs = `
         PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
         PREFIX dc: <http://purl.org/dc/elements/1.1/>
         PREFIX dct: <http://purl.org/dc/terms/>
         PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
         PREFIX edm: <http://www.europeana.eu/schemas/edm/>
         PREFIX foaf: <http://xmlns.com/foaf/0.1/>

         SELECT ?id ?parentId
         WHERE {
               # er wordt van boven naar beneden gewerkt in de hiërarchie
               # geef de categorieën onder wapens en munitie; dit zijn alle parentlabels
               <https://hdl.handle.net/20.500.11840/termmaster12435> skos:narrower* ?cat .
               ?cat skos:prefLabel ?id .

               # geef de term (de "broader term") die daarboven staat in de thesaurus; dit is je 'hoofdterm' nu
               ?cat skos:broader ?catParent .
               ?catParent skos:prefLabel ?parentId .
             }
             GROUP BY ?id ?parentId
             ORDER BY ASC(?id)     `

        const query_aantallen = `
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX dc: <http://purl.org/dc/elements/1.1/>
          PREFIX dct: <http://purl.org/dc/terms/>
          PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
          PREFIX edm: <http://www.europeana.eu/schemas/edm/>
          PREFIX foaf: <http://xmlns.com/foaf/0.1/>
          SELECT ?id (COUNT(?cho) AS ?size)
          WHERE {
           # er wordt van boven naar beneden gewerkt in de hiërarchie
           # geef de categorieën onder wapens en munitie; dit zijn alle parentlabels
           <https://hdl.handle.net/20.500.11840/termmaster12435> skos:narrower* ?cat .
           ?cat skos:prefLabel ?id .
          # geef de term (de "narrower term") die daaronder staat in de thesaurus; dit is je 'hoofdterm' nu
           ?cat skos:broader ?catParent .
           ?catParent skos:prefLabel ?parentId .
          # geef het aantal daadwerkelijke [fysieke] objecten met dit label
          # probleem; rekent niet ook alle objecten in zijn sublabels mee
           OPTIONAL {
            ?cho edm:object ?cat .
           }
          }
          GROUP BY ?id
          ORDER BY ASC(?id)
          `
    loadData(endpoint, query_IDs, query_aantallen)
  }

  function loadData(endpoint, query_IDs, query_aantallen, id_parentID_columns, id_size_columns){
    d3.json(endpoint + '?query=' + encodeURIComponent(query_IDs) + '&format=json').then
    (function(id_parentID_columns){
      console.log(id_parentID_columns)
      // --> je moet wel aangeven aan welke functie je deze gegevens wil returnen/doorgeven
      dataToArray(id_parentID_columns)
      return id_parentID_columns
      // returnbothcolumns()
    })
    d3.json(endpoint + '?query=' + encodeURIComponent(query_aantallen) + '&format=json').then(id_size_columns)



    // console.log(id_size_columns)


    // function returnbothcolumns(id_parentID_columns, id_size_columns){
      // console.log(id_parentID_columns)
    // }
    // console.log(id_parentID_columns)




    dataToArray(id_parentID_columns, id_size_columns)
  }

  function dataToArray(id_parentID_columns, id_size_columns){

  }


  function id_size_columns(){
    console.log(id_size_columns)
  }


// Teken visualisatie
  function drawViz(Data) {
        // Declare d3 layout
        var Layout = d3.pack().size([Width, Height]);

        // Layout + Data
        var Root = d3.hierarchy(Data).sum(function (d) { return d.data.size; });
        var Nodes = Root.descendants();
        Layout(Root);
        var Slices = g.selectAll('circle').data(Nodes).enter().append('circle');

        // Draw on screen
        Slices.attr('cx', function (d) { return d.x; })
            .attr('cy', function (d) { return d.y; })
            .attr('r', function (d) { return d.r; });
    }
</script>
